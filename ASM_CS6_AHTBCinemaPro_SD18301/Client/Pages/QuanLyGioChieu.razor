@page "/giochieus"
@using ASM_CS6_AHTBCinemaPro_SD18301.Models
@using ASM_CS6_AHTBCinemaPro_SD18301.Shared.ViewModels
@using Newtonsoft.Json
@inject HttpClient Http
@code {
    private List<GioChieuViewModel> gioChieus;
    private List<NgayChieuVM> NgayChieus;
    private GioChieuViewModel newGioChieu = new GioChieuViewModel();

    protected override async Task OnInitializedAsync()
    {
        var respone = await Http.GetStringAsync("api/giochieu");
        gioChieus = JsonConvert.DeserializeObject<List<GioChieuViewModel>>(respone);

        var caChieuResponse = await Http.GetStringAsync("api/ngaychieus");
        NgayChieus = JsonConvert.DeserializeObject<List<NgayChieuVM>>(caChieuResponse);
    }

    private async Task HandleValidSubmit()
    {
        var response = await Http.PostAsJsonAsync("api/giochieu", newGioChieu);

        if (response.IsSuccessStatusCode)
        {
            gioChieus = await Http.GetFromJsonAsync<List<GioChieuViewModel>>("api/giochieu");
            newGioChieu = new GioChieuViewModel(); // Reset form
        }
        else
        {
            var errorMessage = await response.Content.ReadAsStringAsync();
            Console.WriteLine($"Error: {errorMessage}");
        }
    }
}
<h1>Danh sách giờ chiếu</h1>

@if (gioChieus == null)
{
    <p>Loading...</p>
}
else
{
    <table class="table text-white">
        <thead>
            <tr>
                <th>Giờ Bắt Đầu - Giờ Kết Thúc</th>
                <th>Ngày Chiếu Phim</th>
                <th>Trạng Thái</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in gioChieus)
            {
                <tr>
                    <td>@item.GioBatDau - @item.GioKetThuc</td>
                    <td>@item.Cachieu</td>
                    <td>@item.TrangThai</td>
                </tr>
            }
        </tbody>
    </table>
}

<h2>Thêm Giờ Chiếu Mới</h2>

<EditForm Model="newGioChieu" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    
    <div class="form-group">
        <label for="gioBatDau">Giờ Bắt Đầu:</label>
        <InputText id="gioBatDau" type="time" class="form-control" @bind-Value="newGioChieu.GioBatDau" />
        <ValidationMessage For="@(() => newGioChieu.GioBatDau)" />
    </div>
    <div class="form-group">
        <label for="gioKetThuc">Giờ Kết Thúc:</label>
        <InputText id="gioKetThuc" type="time" class="form-control" @bind-Value="newGioChieu.GioKetThuc" />
        <ValidationMessage For="@(() => newGioChieu.GioKetThuc)" />
    </div>
    <div class="form-group">
        <label for="caChieu">Ca Chiếu:</label>
        <InputSelect id="caChieu" class="form-control" @bind-Value="newGioChieu.CaChieuId">
            <option value="">-- Chọn Ca Chiếu --</option>
            @if (NgayChieus == null)
            {
                <p>Loading...</p>
            }
            else
            {
                @foreach (var caChieu in NgayChieus)
                {
                    <option  value="@caChieu.IdCaChieu">@caChieu.Phim - @caChieu.NgayChieu - @caChieu.Phong</option>
                }
            }
        </InputSelect>
        <ValidationMessage For="@(() => newGioChieu.CaChieuId)" />
    </div>
    <div class="form-group">
        <label for="trangThai">Trạng Thái:</label>
        <InputText id="trangThai" class="form-control" @bind-Value="newGioChieu.TrangThai" />
        <ValidationMessage For="@(() => newGioChieu.TrangThai)" />
    </div>

    <button type="submit" class="btn btn-primary">Thêm</button>
</EditForm>



